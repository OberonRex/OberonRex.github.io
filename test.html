<!DOCTYPE html>
<html>
<head>
<script>

var query = window.location.search.substring(1);
var vars = query.split("&");

var aa = {};

for (var i=0;i<vars.length;i++) {
    var pair = vars[i].split("=");
    aa[pair[0]] = pair[1];
  }
  
function ImportValues(){
    SetSelect(aa.KEY_HRTICKSTYLE, "hrTickStyle");
    SetSelect(aa.KEY_HRTICKCOUNT, "hrTickCount");
    document.getElementById("hrTickSize").value = aa.KEY_HRTICKLENGTH;
    document.getElementById("hrTickRadius").value = aa.KEY_HRRADIUSTOTIP;
    SetSelect(aa.KEY_WEATHERSOURCE, "WeatherSource");
    document.getElementById("WUKey").value = aa.KEY_WUKEY;
    WeatherChanged();
} 

function SetSelect(tsValue, selectID){
  var selectobject = document.getElementById(selectID);
  for (var i=0; i<selectobject.length; i++){
    if (selectobject.options[i].value == tsValue)
    {
      selectobject.selectedIndex = i;
      break;
    }
  }
}

function allDone(){
  var aa = {
    "KEY_HRTICKSTYLE": document.getElementById("hrTickStyle").options[tSelect.selectedIndex].value,
    "KEY_HRTICKCOUNT": document.getElementById("hrTickCount").options[tSelect.selectedIndex].value,
    "KEY_HRTICKLENGTH": document.getElementById("hrTickSize").value,
    "KEY_HRRADIUSTOTIP": document.getElementById("hrTickRadius").value//,
    //"KEY_WEATHERSOURCE": document.getElementById("WeatherSource").options[tSelect.selectedIndex].value,
    //"KEY_WUKEY": document.getElementById("WUKey").value
  }
  // Close config page and return data
  location.href = 'pebblejs://close#' + JSON.stringify(aa);
}

function WeatherChanged(){
  if (document.getElementById("WeatherSource").selectedIndex == 0)
    document.getElementById("WUKeyDiv").style.display="none";
  else document.getElementById("WUKeyDiv").style.display="table-row";
}

var w;
function CallPicker(){
    w = window.open('colorpicker.html');
}

function CallBack(){
    //alert('callback');
}

</script>
</head>

<body onload="ImportValues()">

<h1>My Configuration Page, v1.42</h1>

<table>
  <tr>
    <td>Hour Tick Style:</td>
    <td>
      <select id="hrTickStyle">
        <option value="0">Lines</option>
        <option value="1">Dots</option>
        <option value="2">Circles</option>
        <option value="3">Circled Dots</option>
      </select>
    </td>
  </tr>
  
  <tr>
    <td>Hour Tick Size: </td>
    <td><input type="text" id="hrTickSize"></td>
  </tr>
  
  <tr>
    <td>Hour Tick Radius: </td>
    <td><input type="text" id="hrTickRadius"></td>
  </tr>
  
  <tr>
    <td>Hour Tick Count:</td>
    <td>
      <select id="hrTickCount">
        <option value="0">0</option>
        <option value="4">4</option>
        <option value="12">12</option>
      </select>
    </td>
  </tr>
  
  <tr><td>&nbsp;</td><td>&nbsp;</td></tr>
        
  <tr>
    <td>Weather Source:</td>
    <td>
      <select id="WeatherSource" onchange="WeatherChanged()">
        <option value="openweather">OpenWeather</option>
        <option value="weatherunderground">Weather Underground</option>
      </select>
    </td>
  </tr>
  
<tr id=WUKeyDiv style="display:none">
  <td>WU Key:</td>
  <td><input type="text" id="WUKey"></td>
</tr>

</table>

<br><br>
<button type="button" onclick="allDone()">Done</button>

<br><br>
<button type="button" onclick="CallPicker();">Color Picker</button>

</body>
</html>
